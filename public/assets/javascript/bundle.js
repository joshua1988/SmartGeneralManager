var myApp=angular.module('myApp',["ng-fusioncharts","angular-datepicker","ngResource"]);myApp.controller("AppCtrl",['$scope','$http',function($scope,$http){var membersNum=0;var refresh=function(){$http.get('/vote').success(function(response,data,status,headers,config){$scope.members=response;membersNum=response.length-1;}).error(function(data,status,headers,config){});$http.get('/date').success(function(response,data,status,headers,config){console.log("I got the data I requested",response[0].date.date);$scope.datePicker=response[0].date.date;}).error(function(data,status,headers,config){});};refresh();$scope.selectedMembers=0;$scope.unselectedMembers=membersNum;$scope.$watch('members',function(members){var selectedMembers=0;var unselectedMembers=membersNum;angular.forEach(members,function(member){selectedMembers+=member.selected?1:0;unselectedMembers-=member.selected?1:0;});$scope.selectedMembers=selectedMembers;$scope.unselectedMembers=unselectedMembers;},true);$scope.save=function(){console.log($scope.members);$http.put('/vote/',{members:$scope.members}).success(function(response){refresh();}).error(function(data,status,headers,config){console.log("error : ",data);});alert("저장되었습니다");};$scope.clear=function(){$http.put('/vote/clear',{members:$scope.members}).success(function(response){refresh();alert("리셋되었습니다");}).error(function(data,status,headers,config){console.log("error : ",data);});};$scope.fields=[];var count=0;var refreshFood=function(){$http.get('/foodmenu').success(function(response,data,status,headers,config){$scope.fields=response;}).error(function(data,status,headers,config){console.log("refreshFood error");});};refreshFood();$scope.addFoodMenu=function(){if($("#foodmenu").val()!==""){count++;$scope.field={name:$scope.foodname,checkedNum:0,count:count};$http.post("/foodmenu/",$scope.field).success(function(response){console.log("post success :",response);}).error(function(data,status,headers,config){console.log("post error : ",data);});refreshFood();$("#foodmenu").val("");}else{alert("메뉴를 입력하세요");}};$scope.saveList=function(){if($scope.fields.length!==0){$http.put("/foodmenu/",$scope.fields).success(function(response){console.log(response);}).error(function(data,status,headers,config){console.log("error : ",data);});alert("소중한 의견 감사합니다.");refreshFood();}else{alert("메뉴가 아직 없습니다");}};$scope.resetList=function(){$http.delete("/foodmenu/").success(function(response){console.log(response);});refreshFood();alert("메뉴 전체가 리셋되었습니다.");};$scope.myDataSource={chart:{caption:"회식 참석현황",subcaption:"2015.09.17",paletteColors:"#0075c2,#f45b00",startingangle:"120",showlabels:"0",showlegend:"1",enablemultislicing:"0",slicingdistance:"15",showpercentvalues:"0",showpercentintooltip:"0",plottooltext:"$label",theme:"ocean",baseFontSize:15,baseFont:"Italics"},data:[{label:"참석자",value:0},{label:"불참석자",value:13}]};$scope.dataSource={chart:{caption:"금주의 추천 메뉴",subCaption:"여러분들의 소중한 의견으로 구성되었습니다",theme:"ocean",baseFontSize:10,},data:[{label:"삼겹살",value:"5"},{label:"불고기",value:"1"},{label:"육회",value:"1"},{label:"양꼬치 & 칭따오",value:"2"},{label:"",value:null}]};$scope.updateMyChartData=function(){$scope.myDataSource.data[0].value=$scope.selectedMembers;$scope.myDataSource.data[1].value=$scope.unselectedMembers;var data=$scope.fields;var x;for(x in data){$scope.dataSource.data[x].value=data[x].checkedNum;$scope.dataSource.data[x].label=data[x].name;}};$scope.chatcontents=[];$scope.typeChatting=function(){console.log("typed something");$scope.chatcontent={content:$scope.chatInput,user:"장기효"};$scope.chatcontents.push($scope.chatcontent);console.log($scope.chatcontent);$scope.chatInput="";};}]);myApp.directive('foodDisplay',function($compile){return{scope:false,templateUrl:'public/assets/foodmenu.html',link:function(scope,element,attrs){scope.change=function(){if(scope.confirmed===true){this.field.checkedNum+=1;}else{this.field.checkedNum-=1;}};}};});myApp.directive('ngEnter',function(){return function(scope,element,attrs){element.bind("keydown keypress",function(event){if(event.which===13){scope.$apply(function(){scope.$eval(attrs.ngEnter);});event.preventDefault();}});};});myApp.directive("datepicker",["$http",function($http){return{restrict:"A",require:"ngModel",link:function(scope,elem,attrs,ngModelCtrl){var updateModel=function(dateText){scope.$apply(function(){ngModelCtrl.$setViewValue(dateText);});};var options={dateFormat:"yy/mm/dd",onSelect:function(dateText){var date={"date":dateText};}};elem.datepicker(options);}};}]);myApp.controller('WhopperCtrl',['$scope','$http','$timeout',function($scope,$http,$timeout){var wc=this;$scope.supportContentList={};$scope.formData={"support_id":null,"support_startdate":null,"support_duedate":null,"support_workbegin":null,"support_workend":null,"questioner":null,"status":null,"project_type":null,"project_target":null,"solution_version":null,"gluepd":null,"sop":null,"content_level":null,"support_content":null};var table="";var initDataTable=function(){$timeout(function(){var rowCount=$("#example tr").length-1;console.log("Row count value is "+rowCount);if(rowCount>=0){console.log("Entered into Sorting");$('#example').show();table=$('#example').DataTable({"order":[[0,'desc']],"retrieve":true,dom:"<'row'<'col-sm-4'l><'col-sm-4'B><'col-sm-4'f>>R"+"<'row'<'col-sm-12'tr>>"+"<'row'<'col-sm-5'i><'col-sm-7'p>>",buttons:['copy','csv','excel','pdf','print',],});console.log(table);}},250);};initDataTable();var reloadDataTable=function(){table.destroy();$('#example').hide();};var supportListRefresh=function(){$http.get('/techsupport').success(function(response,data,status,headers,config){$scope.supportContentList=response;}).error(function(data,status,headers,config){console.log("supportListRefresh get failed ",data);});};supportListRefresh();$scope.supportSubmit=function(){$scope.formData.support_startdate=$("#support_startdate").val();$scope.formData.support_duedate=$("#support_duedate").val();$scope.formData.support_workbegin=$("#support_workbegin").val();$scope.formData.support_workend=$("#support_workend").val();$scope.formData.questioner=$("#questioner").val();$scope.formData.status=$("#status").val();$scope.formData.project_type=$("#project_type").val();$scope.formData.project_target=$("#project_target").val();$scope.formData.solution_version=$("#solution_version").val();$scope.formData.gluepd=$("#gluepd").val();$scope.formData.sop=$("#sop").val();$scope.formData.content_level=$("#content_level").val();$scope.formData.support_content=$("#support_content").val();$http.post('/techsupport',$scope.formData).success(function(response,data,status,headers,config){}).error(function(data,status,headers,config){console.log("post failed ",data);});$("#support_content").val("");supportListRefresh();reloadDataTable();initDataTable();};$scope.supportSearch=function(){console.log("---------------- SEARCH ------------------ ");$http.get('/techsupport').success(function(response,data,status,headers,config){$scope.supportContentList=response;}).error(function(data,status,headers,config){});};$scope.setSelected=function(){$scope.selected=this.support;$("#support_id").val($scope.selected._id);$("#support_startdate").val($scope.selected.support_startdate);$("#support_duedate").val($scope.selected.support_duedate);$("#support_workbegin").val($scope.selected.support_workbegin);$("#support_workend").val($scope.selected.support_workend);$("#questioner").val($scope.selected.questioner).trigger("change");$("#status").val($scope.selected.status).trigger("change");$("#project_type").val($scope.selected.project_type).trigger("change");$("#project_target").val($scope.selected.project_target).trigger("change");$("#solution_version").val($scope.selected.solution_version).trigger("change");$("#gluepd").val($scope.selected.gluepd).trigger("change");$("#sop").val($scope.selected.sop).trigger("change");$("#content_level").val($scope.selected.content_level).trigger("change");$("#support_content").val($scope.selected.support_content);};$scope.supportDelete=function(){$scope.formData.support_id=$("#support_id").val();$http.put('/techsupport',$scope.formData).success(function(response,data,status,headers,config){supportListRefresh();reloadDataTable();initDataTable();}).error(function(data,status,headers,config){console.log("supportListDelete get failed ",data);});};$scope.supportUpdate=function(){$scope.formData.support_id=$("#support_id").val();$scope.formData.support_startdate=$("#support_startdate").val();$scope.formData.support_duedate=$("#support_duedate").val();$scope.formData.support_workbegin=$("#support_workbegin").val();$scope.formData.support_workend=$("#support_workend").val();$scope.formData.questioner=$("#questioner").val();$scope.formData.status=$("#status").val();$scope.formData.project_type=$("#project_type").val();$scope.formData.project_target=$("#project_target").val();$scope.formData.solution_version=$("#solution_version").val();$scope.formData.gluepd=$("#gluepd").val();$scope.formData.sop=$("#sop").val();$scope.formData.content_level=$("#content_level").val();$scope.formData.support_content=$("#support_content").val();$http.put('/techsupport/update',$scope.formData).success(function(response,data,status,headers,config){supportListRefresh();reloadDataTable();initDataTable();}).error(function(data,status,headers,config){console.log("supportUpdate get failed ",data);});};$scope.selectedRow=null;$scope.setClickedRow=function(index){$scope.selectedRow=index;}}]);